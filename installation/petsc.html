
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Building PETSc &#8212; PISM, a Parallel Ice Sheet Model 1.2 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Building PISM" href="pism.html" />
    <link rel="prev" title="Installing PISM using Spack" href="spack.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
<div class="documentwrapper">
  <div class="bodywrapper">
    <div class="body" role="main">
      
  <div class="section" id="building-petsc">
<span id="sec-install-petsc"></span><h1>Building PETSc<a class="headerlink" href="#building-petsc" title="Permalink to this headline">¶</a></h1>
<p>PISM is built on top of <a class="reference external" href="https://www.mcs.anl.gov/petsc/">PETSc</a>, which is actively developed and an up-to-date PETSc
distribution may not be available in package repositories. Download the PETSc
source by grabbing the current gzipped tarball at:</p>
<blockquote>
<div><p><a class="reference external" href="https://www.mcs.anl.gov/petsc/download/index.html">https://www.mcs.anl.gov/petsc/download/index.html</a></p>
</div></blockquote>
<p>(Use version 3.5 or newer; see <a class="reference internal" href="prerequisites.html#sec-install-prerequisites"><span class="std std-ref">Required tools and libraries</span></a> for
details.) The “lite” form of the tarball is fine if you are willing to depend on an
Internet connection for accessing PETSc documentation.</p>
<p>You should configure and build PETSc as described on the PETSc installation page, but it
might be best to read the following comments on the PETSc configure and build process
first:</p>
<ol class="arabic">
<li><p>Untar in your preferred location and enter the new PETSc directory. Note PETSc should
<em>not</em> be configured using root privileges. When you run the configure script the
following options are recommended; note PISM uses shared libraries by default:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">PETSC_DIR</span><span class="o">=</span><span class="nv">$PWD</span>
<span class="nb">export</span> <span class="nv">PETSC_ARCH</span><span class="o">=</span>opt
./config/configure.py --with-shared-libraries <span class="se">\</span>
                      --with-debugging<span class="o">=</span><span class="m">0</span> <span class="se">\</span>
                      --with-fc<span class="o">=</span><span class="m">0</span>
</pre></div>
</div>
<p>You need to define the environment variables <code class="docutils literal notranslate"><span class="pre">PETSC_DIR</span></code> and <code class="docutils literal notranslate"><span class="pre">PETSC_ARCH</span></code> <a class="footnote-reference brackets" href="#id2" id="id1">1</a> –
one way is shown here – <em>before</em> running the configuration script. Turning off the
inclusion of debugging code and symbols can give a significant speed improvement, but
some kinds of development will benefit from setting <code class="docutils literal notranslate"><span class="pre">--with-debugging=1</span></code>. Using
shared libraries may be unwise on certain clusters; check with your system
administrator. PISM does not use PETSc’s Fortran API, so the Fortran compiler is
disabled by <code class="docutils literal notranslate"><span class="pre">--with-fc=0</span></code>.</p>
</li>
<li><p>It is sometimes convenient to have PETSc grab a local copy of BLAS and LAPACK rather
than using the system-wide version. So one may add “<code class="docutils literal notranslate"><span class="pre">--download-f2cblaslapack=1</span></code>” to
the other configure options.</p></li>
<li><p>If there is an existing MPI installation, we recommend using MPI’s compiler wrappers to
specify an MPI library when installing PETSc, for example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CC</span><span class="o">=</span>mpicc <span class="nv">CXX</span><span class="o">=</span>mpicxx ./config/configure.py --with-shared-libraries <span class="se">\</span>
                                          --with-debugging<span class="o">=</span><span class="m">0</span> <span class="se">\</span>
                                          --with-fc<span class="o">=</span><span class="m">0</span>
</pre></div>
</div>
<p>If you get messages suggesting that PETSc cannot configure using your existing MPI, you
might want to try adding the <code class="docutils literal notranslate"><span class="pre">--download-mpich=1</span></code> (or <code class="docutils literal notranslate"><span class="pre">--download-openmpi=1</span></code>)
option to PETSc’s configure command.</p>
</li>
<li><p>Configuration of PETSc for a batch system requires special procedures described at the
PETSc documentation site. One starts with a configure option <code class="docutils literal notranslate"><span class="pre">--with-batch=1</span></code>. See
the “Installing on machine requiring cross compiler or a job scheduler” section of the
<a class="reference external" href="https://www.mcs.anl.gov/petsc/documentation/installation.html">PETSc installation page</a>.</p></li>
<li><p>Configuring PETSc may take a moment even when everything goes smoothly. A value for the
environment variable <code class="docutils literal notranslate"><span class="pre">PETSC_ARCH</span></code> will be reported at the end of the configure
process; take note of this value. One may always reconfigure with additional
<code class="docutils literal notranslate"><span class="pre">PETSC_ARCH</span></code> as needed.</p></li>
<li><p>After <code class="docutils literal notranslate"><span class="pre">configure.py</span></code> finishes, you will need to run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">all</span> <span class="pre">test</span></code> in the PETSc
directory and watch the result.</p></li>
</ol>
<p class="rubric">Footnotes</p>
<dl class="footnote brackets">
<dt class="label" id="id2"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>The <code class="docutils literal notranslate"><span class="pre">PETSC_ARCH</span></code> variable is just a string you can use to choose different PETSc
configurations and does not have any other significance.</p>
</dd>
</dl>
</div>


      <hr>
      <table style="width: 100%">
        <tr>
          <td style="text-align: left; width: 30%">
              <a class="reference internal" href="spack.html">Previous</a>
          </td>
          <td style="text-align: center; width: 30%">
              <a class="reference internal" href="cookbook.html">Up</a>
          </td>
          <td style="text-align: right; width: 30%">
              <a class="reference internal" href="pism.html">Next</a>
          </td>
        </tr>
      </table>
    </div>
  </div>
</div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/pism-logo.png" alt="Logo"/>
    
  </a>
</p>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../acknowledgements.html">Acknowledgements</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Installing PISM</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="prerequisites.html">Required tools and libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel-io-libraries.html">Installing parallel I/O libraries</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="cookbook.html">Installation Cookbook</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="debian.html">Installing prerequisites on Debian or Ubuntu</a></li>
<li class="toctree-l3"><a class="reference internal" href="arch.html">Installing prerequisites and building PISM on Arch Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="macos.html">Installing required libraries on macOS</a></li>
<li class="toctree-l3"><a class="reference internal" href="spack.html">Installing PISM using Spack</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Building PETSc</a></li>
<li class="toctree-l3"><a class="reference internal" href="pism.html">Building PISM</a></li>
<li class="toctree-l3"><a class="reference internal" href="common-problems.html">Common build problems and solutions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="quick-tests.html">Quick tests of the installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="quick-tests.html#next-steps">Next steps</a></li>
<li class="toctree-l2"><a class="reference internal" href="documentation.html">Rebuilding PISM documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../manual/index.html">PISM User’s Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../climate_forcing/index.html">Climate forcing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../technical/index.html">Technical notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing to PISM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authorship.html">Authorship</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zzz_references_html.html">References</a></li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      Git revision v1.0-1840-g248f66242
      committed by Constantine Khrulev
      on 2020-09-02 09:56:04 -0800 |
      &copy; 2004--2020, the PISM authors.
      
    </div>
  </body>
</html>